<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PINKVERSE - Marketplace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&family=Playfair+Display:wght:500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff3f6c;
            --dark-pink: #d62b55;
            --bg-grey: #fafafa;
            --text-dark: #282c3f;
        }

        body {
            font-family: 'Assistant', sans-serif;
            background-color: var(--bg-grey);
            color: var(--text-dark);
            overflow-x: hidden;
        }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        /* --- ANIMATIONS --- */
        @keyframes kenBurns { 0% { transform: scale(1); } 100% { transform: scale(1.1); } }
        .ken-burns { animation: kenBurns 20s ease-in-out infinite alternate; }

        @keyframes springBounce {
            0% { opacity: 0; transform: translateY(40px) scale(0.8); }
            60% { transform: translateY(-5px) scale(1.02); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .anim-spring { opacity: 0; animation: springBounce 0.7s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

        .ripple-btn { position: relative; overflow: hidden; }
        .ripple { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.5); transform: scale(0); animation: ripple-effect 0.6s linear; pointer-events: none; }
        @keyframes ripple-effect { to { transform: scale(4); opacity: 0; } }

        .card-shadow { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-shadow:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(255, 63, 108, 0.2); }

        .sidebar-anim { transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.24, 0.47, 0.49, 0.98); }
        .sidebar-anim.open { transform: translateX(0); }

        .product-img-box { position: relative; overflow: hidden; height: 360px; }
        .product-img-box img { transition: transform 0.6s ease; }
        .card-shadow:hover .product-img-box img { transform: scale(1.1); }

        .fly-img { position: fixed; z-index: 9999; pointer-events: none; transition: all 0.9s cubic-bezier(0.17, 0.67, 0.32, 1.3); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        input:focus, textarea:focus, select:focus { animation: breathe 2s ease-in-out infinite alternate; }
        @keyframes breathe { from { box-shadow: 0 0 0 0 rgba(255, 63, 108, 0.4); } to { box-shadow: 0 0 0 8px rgba(255, 63, 108, 0); } }

        /* Biometric UI */
        .scanner-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 4px solid rgba(0,0,0,0.1); transition: all 0.3s; }
        .fingerprint-container { position: relative; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 50%; cursor: pointer; transition: transform 0.2s, border-color 0.3s; border: 1px solid #eee; }
        .fingerprint-container:active { transform: scale(0.95); }
        @keyframes scanLine { 0% { top: 10%; opacity: 0; } 50% { opacity: 1; } 100% { top: 90%; opacity: 0; } }
        .scan-line { position: absolute; width: 80%; height: 4px; background: var(--primary); box-shadow: 0 0 10px var(--primary); border-radius: 2px; display: none; }
        .scanning .scan-line { display: block; animation: scanLine 1s infinite linear; }
        .scanning .scanner-ring { border-color: var(--primary); box-shadow: 0 0 0 10px rgba(255, 63, 108, 0.1); }
        .success-bio { border-color: #03a685 !important; background: #e6fffa !important; animation: successPulse 0.5s ease-out; }
        .fail-bio { animation: shake 0.5s; border-color: #ff0000 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes successPulse { 0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(3, 166, 133, 0.4); } 100% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(3, 166, 133, 0); } }

        /* Seller Specific */
        .upload-zone { border: 2px dashed #e0e0e0; transition: all 0.3s; cursor: pointer; position: relative; }
        .upload-zone:hover { border-color: var(--primary); background: #fff0f3; }
        .upload-zone.has-img { border: none; }
    </style>
</head>
<body>

    <!-- Sidebar Overlay -->
    <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-40 hidden transition-all duration-500 opacity-0"></div>
    
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar-anim fixed top-0 left-0 h-full w-72 bg-white shadow-2xl z-50 flex flex-col">
        <div class="p-6 bg-gradient-to-br from-pink-600 to-red-500 text-white relative overflow-hidden">
            <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/20 rounded-full"></div>
            <h2 class="font-bold text-xl relative z-10">Menu</h2>
        </div>
        <nav class="p-4 flex-1 overflow-y-auto" id="sidebar-nav"></nav>
        <div class="p-4 border-t space-y-2">
            <button onclick="navigate('seller')" class="w-full py-2 bg-pink-50 text-pink-600 rounded font-semibold text-sm hover:bg-pink-100 transition flex items-center justify-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                Sell with Us
            </button>
            <button id="auth-btn-sidebar" onclick="handleAuthClick()" class="w-full py-2 bg-gray-100 rounded font-semibold text-sm hover:bg-gray-200 transition">Login</button>
        </div>
    </div>

    <!-- App Container -->
    <div id="app" class="transition-opacity duration-300"></div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-10 right-10 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-2xl hidden transform translate-y-20 transition-all duration-500 z-50 flex items-center gap-3">
        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
        <span>Done</span>
    </div>

    <script>
        // ==========================================
        // 1. DATA STORE & STATE
        // ==========================================
        const brands = ["Zentro", "NexaTech", "UrbanWeave", "StyleHive", "VoltEdge", "AuraWear"];
        const categories = [
            { name: "Electronics", priceRange: [1999, 89999], imgKey: "laptop" },
            { name: "Mobiles", priceRange: [7999, 69999], imgKey: "smartphone" },
            { name: "Fashion", priceRange: [499, 4999], imgKey: "fashion" },
            { name: "Shoes", priceRange: [799, 5999], imgKey: "shoes" },
            { name: "Watches", priceRange: [999, 12999], imgKey: "watch" },
            { name: "Beauty", priceRange: [199, 2999], imgKey: "beauty" }
        ];

        const DB = {
            products: [],
            cart: JSON.parse(localStorage.getItem('cart')) || [],
            wishlist: JSON.parse(localStorage.getItem('wishlist')) || [],
            user: { name: "Ananya Sharma", phone: "9988776655", pincode: "400069", address: "42, Linking Road", city: "Mumbai", state: "Maharashtra" },
            isLoggedIn: JSON.parse(localStorage.getItem('isLoggedIn')) || false
        };

        // Initialize Products
        const initProducts = () => {
            const storedProducts = localStorage.getItem('pv_products');
            if (storedProducts) {
                DB.products = JSON.parse(storedProducts);
            } else {
                for(let i = 1; i <= 20; i++) {
                    const cat = categories[i % categories.length];
                    const brand = brands[Math.floor(Math.random() * brands.length)];
                    const price = Math.floor(Math.random() * (cat.priceRange[1] - cat.priceRange[0] + 1)) + cat.priceRange[0];
                    const discount = Math.floor(Math.random() * 60) + 5;
                    DB.products.push({
                        id: Date.now() + i,
                        title: `${brand} Premium Edition`,
                        brand: brand,
                        category: cat.name,
                        price: Math.round(price * (1 - discount/100)),
                        originalPrice: price,
                        discount: `${discount}%`,
                        rating: (Math.random() * 1.1 + 3.8).toFixed(1),
                        reviews: Math.floor(Math.random() * 9950) + 50,
                        image: `https://loremflickr.com/400/500/${cat.imgKey}?random=${i}`
                    });
                }
                localStorage.setItem('pv_products', JSON.stringify(DB.products));
            }
        };
        initProducts();

        // ==========================================
        // 2. UTILITIES
        // ==========================================
        const $ = (id) => document.getElementById(id);
        const create = (tag, cls) => { const el = document.createElement(tag); el.className = cls; return el; };

        const showToast = (msg, isError=false) => {
            const t = $('toast');
            t.querySelector('span').innerText = msg;
            t.className = `fixed bottom-10 right-10 px-6 py-3 rounded-lg shadow-2xl transform transition-all duration-500 z-50 flex items-center gap-3 ${isError ? 'bg-red-600' : 'bg-gray-900'} text-white`;
            t.classList.remove('hidden', 'translate-y-20');
            setTimeout(() => t.classList.add('translate-y-20'), 3000);
        };

        const save = () => { 
            localStorage.setItem('cart', JSON.stringify(DB.cart)); 
            localStorage.setItem('isLoggedIn', JSON.stringify(DB.isLoggedIn));
            updateCounts(); 
        };
        
        const saveProducts = () => localStorage.setItem('pv_products', JSON.stringify(DB.products));
        const updateCounts = () => { const c = $('cart-count'); if(c) c.innerText = DB.cart.length; };

        const createRipple = (event) => {
            const button = event.currentTarget;
            const circle = document.createElement("span");
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
            circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
            circle.classList.add("ripple");
            const ripple = button.getElementsByClassName("ripple")[0];
            if (ripple) ripple.remove();
            button.appendChild(circle);
        };

        // ==========================================
        // 3. ROUTER
        // ==========================================
        const navigate = (page, data=null) => {
            window.scrollTo(0,0);
            if(page === 'checkout' && !DB.isLoggedIn) {
                showToast("Biometric Verification Required", true);
                page = 'login';
            }

            const app = $('app');
            app.style.opacity = 0;
            app.style.transform = "translateY(10px)";
            
            setTimeout(() => {
                app.innerHTML = '';
                switch(page) {
                    case 'home': renderHome(); break;
                    case 'login': renderLogin(); break;
                    case 'seller': renderSeller(); break;
                    case 'product': renderProduct(data); break;
                    case 'cart': renderCart(); break;
                    case 'checkout': renderCheckout(); break;
                    case 'success': renderSuccess(); break;
                    default: renderHome();
                }
                setTimeout(() => { app.style.opacity = 1; app.style.transform = "translateY(0)"; }, 50);
            }, 300);
        };

        // ==========================================
        // 4. RENDER: SELLER DASHBOARD (With Photo Upload)
        // ==========================================
        const renderSeller = () => {
            const app = $('app');
            app.appendChild(renderHeader());

            const container = create('div', 'container mx-auto p-6 max-w-3xl');
            container.innerHTML = `
                <div class="anim-spring bg-white rounded-2xl shadow-xl overflow-hidden">
                    <div class="bg-gradient-to-r from-pink-600 to-rose-500 p-6 text-white">
                        <h2 class="text-2xl font-bold">Seller Dashboard</h2>
                        <p class="text-sm opacity-90">List your product for millions of buyers</p>
                    </div>

                    <div class="p-8 space-y-6">
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-1">PRODUCT NAME</label>
                            <input type="text" id="s_name" class="w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="e.g. Premium Cotton T-Shirt">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">BRAND</label>
                                <input type="text" id="s_brand" class="w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="e.g. MyBrand">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">CATEGORY</label>
                                <select id="s_cat" class="w-full px-4 py-3 rounded-lg border focus:outline-none transition-all bg-white">
                                    ${categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">PRICE (â‚¹)</label>
                                <input type="number" id="s_price" class="w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="e.g. 999">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 block mb-1">ORIGINAL PRICE (â‚¹)</label>
                                <input type="number" id="s_oprice" class="w-full px-4 py-3 rounded-lg border focus:outline-none transition-all" placeholder="e.g. 1999">
                            </div>
                        </div>

                        <!-- PHOTO UPLOAD SECTION -->
                        <div>
                            <label class="text-xs font-bold text-gray-500 block mb-1">PRODUCT PHOTO</label>
                            <div id="upload-zone" class="upload-zone rounded-xl h-48 flex flex-col items-center justify-center bg-gray-50 overflow-hidden">
                                <input type="file" id="s_file" accept="image/*" class="hidden" onchange="handleImageUpload(this)">
                                <div id="upload-placeholder" class="text-center p-4">
                                    <svg class="w-10 h-10 text-gray-400 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                    <p class="text-gray-500 text-sm font-semibold">Click to upload photo</p>
                                    <p class="text-gray-400 text-xs mt-1">PNG, JPG up to 5MB</p>
                                </div>
                                <img id="img_preview" src="" class="hidden w-full h-full object-cover">
                            </div>
                        </div>

                        <button onclick="submitProduct()" class="w-full bg-pink-500 text-white py-4 rounded-lg font-bold hover:bg-pink-600 transition ripple-btn active:scale-95">
                            LIST PRODUCT
                        </button>
                    </div>
                </div>
            `;
            app.appendChild(container);
            
            // Bind click event to trigger file input
            $('upload-zone').addEventListener('click', () => $('s_file').click());
        };

        // Handle Image Selection & Preview
        window.handleImageUpload = (input) => {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function(e) {
                    // Show preview
                    const imgPreview = $('img_preview');
                    imgPreview.src = e.target.result;
                    imgPreview.classList.remove('hidden');
                    $('upload-placeholder').classList.add('hidden');
                    $('upload-zone').classList.add('has-img');
                };

                reader.readAsDataURL(file); // Convert to base64
            }
        };

        window.submitProduct = () => {
            const name = $('s_name').value;
            const brand = $('s_brand').value;
            const cat = $('s_cat').value;
            const price = parseInt($('s_price').value);
            const oPrice = parseInt($('s_oprice').value);
            const imgSrc = $('img_preview').src;

            if(!name || !brand || !price || !oPrice) {
                showToast("Please fill all fields", true);
                return;
            }
            if(!imgSrc || imgSrc === "") {
                showToast("Please upload a product photo", true);
                return;
            }

            const discount = Math.round(((oPrice - price) / oPrice) * 100);

            const newProd = {
                id: Date.now(),
                title: name,
                brand: brand,
                category: cat,
                price: price,
                originalPrice: oPrice,
                discount: `${discount}%`,
                rating: "4.8",
                reviews: 0,
                image: imgSrc // This is the Base64 data
            };

            DB.products.unshift(newProd);
            saveProducts();
            showToast("Product Listed Successfully!");
            navigate('home');
        };

        // ==========================================
        // 5. RENDER: LOGIN (BIOMETRIC)
        // ==========================================
        const renderLogin = () => {
            const app = $('app');
            app.appendChild(renderHeader(true));
            const container = create('div', 'min-h-[80vh] flex items-center justify-center p-4');
            container.innerHTML = `
                <div class="w-full max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden anim-spring relative" id="login-card">
                    <div class="p-10 bg-gradient-to-tr from-pink-500 to-rose-400 text-white text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-black/10 backdrop-blur-sm z-0 hidden" id="success-overlay"></div>
                        <h2 class="relative z-10 text-3xl font-bold brand-font">Secure Access</h2>
                        <p class="relative z-10 text-sm opacity-90 mt-1">Biometric Authentication</p>
                    </div>
                    
                    <div class="p-10 flex flex-col items-center justify-center">
                        <p class="text-xs text-gray-500 mb-6 uppercase tracking-widest">Please verify your identity</p>
                        
                        <div id="bio-container" class="fingerprint-container">
                            <div class="scanner-ring"></div>
                            <div class="scan-line"></div>
                            <svg class="w-12 h-12 text-gray-400 z-10 transition-colors" id="fingerprint-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4" />
                            </svg>
                        </div>
                        
                        <p class="mt-6 text-xs font-bold text-gray-600 h-4" id="bio-status">Tap & Hold to Scan</p>
                        <div class="mt-8 w-full bg-gray-100 rounded-full h-2 overflow-hidden">
                            <div id="progress-bar" class="h-full bg-pink-500 transition-all duration-100" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            `;
            app.appendChild(container);

            const bioContainer = $('bio-container');
            const bioStatus = $('bio-status');
            const icon = $('fingerprint-icon');
            const progressBar = $('progress-bar');
            const loginCard = $('login-card');
            const successOverlay = $('success-overlay');
            let scanInterval; let progress = 0;

            const startScan = () => {
                if(DB.isLoggedIn) return;
                bioContainer.classList.add('scanning');
                bioStatus.innerText = "Verifying...";
                bioStatus.className = "mt-6 text-xs font-bold text-pink-500 h-4";
                scanInterval = setInterval(() => {
                    if(progress < 100) { progress += 2; progressBar.style.width = `${progress}%`; } 
                    else { clearInterval(scanInterval); onScanSuccess(); }
                }, 40);
            };

            const endScan = () => {
                if(DB.isLoggedIn) return;
                clearInterval(scanInterval);
                if(progress < 100) {
                    bioContainer.classList.remove('scanning');
                    bioContainer.classList.add('fail-bio');
                    bioStatus.innerText = "Scan Failed. Try Again.";
                    bioStatus.className = "mt-6 text-xs font-bold text-red-500 h-4";
                    setTimeout(() => {
                        bioContainer.classList.remove('fail-bio');
                        bioStatus.innerText = "Tap & Hold to Scan";
                        bioStatus.className = "mt-6 text-xs font-bold text-gray-600 h-4";
                        progress = 0; progressBar.style.width = "0%";
                    }, 500);
                }
            };

            const onScanSuccess = () => {
                DB.isLoggedIn = true; save();
                bioContainer.classList.remove('scanning');
                bioContainer.classList.add('success-bio');
                icon.classList.remove('text-gray-400'); icon.classList.add('text-green-500');
                bioStatus.innerText = "Access Granted";
                bioStatus.className = "mt-6 text-xs font-bold text-green-500 h-4";
                successOverlay.classList.remove('hidden');
                setTimeout(() => {
                    loginCard.style.transition = "all 0.5s"; loginCard.style.opacity = "0"; loginCard.style.transform = "scale(1.1)";
                    setTimeout(() => navigate('home'), 500);
                }, 1000);
            };

            bioContainer.addEventListener('mousedown', startScan);
            bioContainer.addEventListener('mouseup', endScan);
            bioContainer.addEventListener('mouseleave', endScan);
            bioContainer.addEventListener('touchstart', (e) => { e.preventDefault(); startScan(); });
            bioContainer.addEventListener('touchend', endScan);
        };

        window.handleAuthClick = () => {
            if(DB.isLoggedIn) { DB.isLoggedIn = false; save(); showToast("Logged Out"); updateSidebarAuth(); navigate('home'); } 
            else { toggleSidebar(); navigate('login'); }
        };

        const updateSidebarAuth = () => { const btn = $('auth-btn-sidebar'); if(btn) btn.innerText = DB.isLoggedIn ? 'Logout' : 'Login'; };

        // ==========================================
        // 6. RENDER: HEADER
        // ==========================================
        const renderHeader = (isLoginPage = false) => {
            const header = create('header', 'sticky top-0 z-30 bg-white/95 backdrop-blur-md border-b border-gray-100 shadow-sm');
            header.innerHTML = `
                <div class="flex items-center px-4 h-16">
                    <button onclick="toggleSidebar()" class="p-2 mr-2 hover:bg-gray-100 rounded-full transition-transform active:scale-90">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
                    </button>
                    <div class="font-bold text-2xl cursor-pointer pr-6" onclick="navigate('home')">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-pink-500 to-red-500">PINKVERSE</span>
                    </div>
                    
                    <nav class="hidden lg:flex items-center h-full">
                        ${categories.slice(0, 5).map(c => `<div class="px-3 py-4 text-xs font-semibold uppercase tracking-wide hover:text-pink-500 cursor-pointer transition-colors" onclick="filterProducts('${c.name}')">${c.name}</div>`).join('')}
                    </nav>

                    <div class="flex-1 px-6">
                        <div class="search-box w-full max-w-xl flex items-center bg-gray-100 rounded-full px-4 py-2 transition-all focus-within:ring-2 ring-pink-300 focus-within:bg-white">
                            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                            <input type="text" id="search-input" placeholder="Search..." onkeyup="searchProducts(this.value)" class="bg-transparent border-none outline-none w-full ml-2 text-sm">
                        </div>
                    </div>

                    <div class="flex items-center gap-2">
                        ${!isLoginPage ? `
                        <div onclick="navigate('seller')" class="hidden md:block p-2 rounded-full hover:bg-pink-50 transition cursor-pointer">
                            <div class="flex flex-col items-center">
                                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                                <span class="text-[10px] font-bold text-gray-500">Sell</span>
                            </div>
                        </div>
                        <div onclick="handleAuthClick()" class="hidden md:block p-2 rounded-full hover:bg-pink-50 transition cursor-pointer">
                            <div class="flex flex-col items-center">
                                <svg class="w-5 h-5 ${DB.isLoggedIn ? 'text-pink-500' : 'text-gray-600'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                <span class="text-[10px] font-bold text-gray-500">${DB.isLoggedIn ? 'Logout' : 'Login'}</span>
                            </div>
                        </div>
                        ` : ''}
                        
                        <div id="cart-icon-container" class="relative cursor-pointer hover:text-pink-500 transition-all active:scale-90" onclick="navigate('cart')">
                            <div class="p-2 rounded-full hover:bg-pink-50">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
                                <span id="cart-count" class="absolute -top-1 -right-1 bg-pink-500 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            return header;
        };

        const initSidebar = () => {
            const nav = $('sidebar-nav');
            nav.innerHTML = '';
            const allBtn = create('a', 'block p-3 rounded hover:bg-pink-50 cursor-pointer text-sm font-bold text-pink-600 transition-colors');
            allBtn.innerText = "All Products";
            allBtn.onclick = () => filterProducts('All');
            nav.appendChild(allBtn);
            categories.forEach(c => {
                const a = create('a', 'block p-3 rounded hover:bg-pink-50 cursor-pointer text-sm font-medium transition-colors hover:pl-5');
                a.innerText = c.name;
                a.onclick = () => filterProducts(c.name);
                nav.appendChild(a);
            });
            updateSidebarAuth();
        };

        // ==========================================
        // 7. RENDER: HOME & GRID
        // ==========================================
        const renderHome = () => {
            const app = $('app');
            app.appendChild(renderHeader());
            initSidebar();

            const banner = create('div', 'relative h-96 overflow-hidden');
            banner.innerHTML = `
                <div class="absolute inset-0 z-0">
                    <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?w=1200" class="w-full h-full object-cover ken-burns">
                    <div class="absolute inset-0 bg-gradient-to-r from-pink-600/80 to-transparent"></div>
                </div>
                <div class="relative z-10 h-full flex items-center p-10 md:p-20">
                    <div class="anim-spring">
                        <h2 class="text-6xl font-bold text-white mb-2 brand-font drop-shadow-lg">Marketplace</h2>
                        <p class="text-xl text-white/90 mb-6">Discover & Sell</p>
                        <button class="bg-white text-pink-600 font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ripple-btn" onclick="filterProducts('All')">
                            Shop Now
                        </button>
                    </div>
                </div>
            `;
            app.appendChild(banner);

            const container = create('div', 'container mx-auto px-4 py-10');
            container.innerHTML = `<h3 id="page-title" class="text-xl font-bold text-gray-800 mb-6 border-l-4 border-pink-500 pl-3">ALL PRODUCTS</h3>`;
            
            const grid = create('div', 'grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6');
            container.appendChild(grid);
            app.appendChild(container);

            renderProductGrid(grid, DB.products);
        };

        const renderProductGrid = (container, list) => {
            container.innerHTML = '';
            if(list.length === 0) { container.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">No products found.</div>'; return; }
            list.forEach((p, i) => {
                const card = create('div', `card-shadow bg-white rounded-xl overflow-hidden anim-spring cursor-pointer`);
                card.style.animationDelay = `${i * 0.05}s`;
                card.innerHTML = `
                    <div class="product-img-box" onclick="navigate('product', ${p.id})">
                        <img src="${p.image}" loading="lazy" alt="${p.title}" class="w-full h-full object-cover">
                        <div class="absolute top-2 left-2 bg-pink-500 text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg">${p.discount} OFF</div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-bold text-sm text-gray-800 truncate">${p.brand}</h4>
                        <p class="text-gray-500 text-xs truncate mb-2">${p.title}</p>
                        <div class="flex items-baseline gap-2">
                            <span class="font-bold text-base">â‚¹${p.price.toLocaleString()}</span>
                            <span class="text-gray-400 text-xs line-through">â‚¹${p.originalPrice.toLocaleString()}</span>
                        </div>
                        <button onclick="addToCart(event, ${p.id}, '${p.image}')" class="mt-3 w-full bg-pink-50 text-pink-600 font-bold py-2 text-xs rounded hover:bg-pink-500 hover:text-white transition-all ripple-btn">
                            ADD TO BAG
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        };

        // ==========================================
        // 8. ACTIONS
        // ==========================================
        window.addToCart = (e, id, imgSrc) => {
            if(!DB.cart.find(i => i.id === id)) {
                DB.cart.push({id: id}); save();
                const cartIcon = $('cart-icon-container').getBoundingClientRect();
                const flyer = document.createElement('div');
                flyer.className = 'fly-img rounded-xl overflow-hidden';
                flyer.innerHTML = `<img src="${imgSrc}" class="w-20 h-24 object-cover">`;
                document.body.appendChild(flyer);
                const startRect = e.target.getBoundingClientRect();
                flyer.style.left = startRect.left + 'px';
                flyer.style.top = startRect.top + 'px';
                setTimeout(() => { flyer.style.left = cartIcon.left + 'px'; flyer.style.top = cartIcon.top + 'px'; flyer.style.transform = 'scale(0.1)'; flyer.style.opacity = '0.5'; }, 10);
                setTimeout(() => flyer.remove(), 900);
                showToast("Added to Bag");
            }
        };

        window.toggleSidebar = () => {
            $('sidebar').classList.toggle('open');
            const overlay = $('overlay');
            const isOpen = $('sidebar').classList.contains('open');
            if(isOpen) { overlay.classList.remove('hidden'); setTimeout(() => overlay.classList.remove('opacity-0'), 10); }
            else { overlay.classList.add('opacity-0'); setTimeout(() => overlay.classList.add('hidden'), 300); }
        };

        window.filterProducts = (cat) => {
            const filtered = cat === 'All' ? DB.products : DB.products.filter(p => p.category === cat);
            const grid = document.querySelector('.grid');
            if(grid) renderProductGrid(grid, filtered);
            toggleSidebar();
        };

        window.searchProducts = (term) => {
            const filtered = DB.products.filter(p => p.title.toLowerCase().includes(term.toLowerCase()));
            const grid = document.querySelector('.grid');
            if(grid) renderProductGrid(grid, filtered);
        };

        // ==========================================
        // 9. RENDER: CART, CHECKOUT, SUCCESS
        // ==========================================
        const renderCart = () => {
            const app = $('app');
            app.appendChild(renderHeader());
            let total = 0; let totalMrp = 0;

            const container = create('div', 'container mx-auto p-6');
            container.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-gray-800">Shopping Bag</h2>`;
            
            const grid = create('div', 'grid md:grid-cols-3 gap-8');
            const items = create('div', 'md:col-span-2 space-y-4');

            if(DB.cart.length === 0) {
                items.innerHTML = `<div class="text-center py-12 bg-white rounded-xl text-gray-500">Your bag is empty.</div>`;
            } else {
                DB.cart.forEach((item, i) => {
                    const p = DB.products.find(x => x.id === item.id);
                    if(!p) return;
                    total += p.price; totalMrp += p.originalPrice;
                    items.innerHTML += `
                        <div class="flex gap-4 bg-white p-4 rounded-xl shadow-sm anim-spring" style="animation-delay: ${i*0.1}s">
                            <img src="${p.image}" class="w-24 h-28 object-cover rounded-lg shadow-inner">
                            <div class="flex-1">
                                <h3 class="font-bold text-gray-800">${p.brand}</h3>
                                <p class="text-xs text-gray-500 mb-2">${p.title}</p>
                                <p class="font-bold">â‚¹${p.price.toLocaleString()}</p>
                                <button onclick="removeFromCart(${p.id})" class="mt-2 text-xs text-red-400 font-bold">Remove</button>
                            </div>
                        </div>
                    `;
                });
            }

            grid.appendChild(items);
            const summary = create('div', 'bg-white p-6 rounded-xl shadow-sm h-fit sticky top-20 anim-spring');
            summary.innerHTML = `
                <h3 class="font-bold text-gray-800 mb-4 text-sm uppercase">Price Details</h3>
                <div class="flex justify-between font-bold text-lg mb-6"><span>Total</span><span class="text-pink-600">â‚¹${total.toLocaleString()}</span></div>
                <button onclick="navigate('checkout')" class="w-full bg-gray-900 text-white py-3 rounded-lg font-bold hover:bg-gray-800 transition ripple-btn active:scale-95">PLACE ORDER</button>
            `;
            grid.appendChild(summary);
            container.appendChild(grid);
            app.appendChild(container);
        };

        const renderCheckout = () => {
            const app = $('app');
            let total = DB.cart.reduce((sum, i) => { const p = DB.products.find(x=>x.id===i.id); return sum + (p ? p.price : 0); }, 0);
            const container = create('div', 'min-h-screen bg-gray-100');
            container.innerHTML = `
                <div class="bg-pink-500 text-white p-4 text-center font-bold">ðŸ”’ Secure Checkout</div>
                <div class="container mx-auto p-6 grid lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 space-y-6 bg-white p-6 rounded-xl anim-spring">
                        <h3 class="font-bold text-gray-700">Order Summary</h3>
                        <p class="text-sm text-gray-500">Amount: <b class="text-pink-600">â‚¹${total.toLocaleString()}</b></p>
                        <div id="qrcode" class="mt-4 flex justify-center"></div>
                    </div>
                    <div class="lg:col-span-1">
                         <button onclick="navigate('success')" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition ripple-btn active:scale-95 anim-spring">Pay Now</button>
                    </div>
                </div>
            `;
            app.appendChild(container);
            if(window.QRCode && total > 0) { $('qrcode').innerHTML = ''; new QRCode($('qrcode'), { text: `upi://pay?pa=shop@upi&am=${total}`, width: 140, height: 140 }); }
        };

        const renderSuccess = () => { DB.cart = []; save(); const app = $('app'); app.innerHTML = `<div class="h-screen flex flex-col items-center justify-center bg-gradient-to-br from-pink-50 to-white text-center p-6"><div class="anim-spring"><svg class="checkmark mx-auto" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg><h1 class="text-3xl font-bold text-gray-800 mt-6 mb-2">Order Placed!</h1><button onclick="navigate('home')" class="mt-6 bg-pink-500 text-white px-8 py-3 rounded-full font-bold shadow-lg hover:bg-pink-600 transition ripple-btn active:scale-95">Continue Shopping</button></div></div>`; };

        window.removeFromCart = (id) => { DB.cart = DB.cart.filter(i => i.id !== id); save(); renderCart(); };

        // Ripple Listener
        document.addEventListener('click', function(e) { if(e.target.classList.contains('ripple-btn')) createRipple(e); });

        // Init
        navigate('home');

    </script>
</body>
</html>
